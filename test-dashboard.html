<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZKSentinel - Test Dashboard</title>
    <link href="https://fonts.googleapis.com/css2? family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            padding: 2rem;
            font-family: 'Rajdhani', sans-serif;
            background: #0a0a0a;
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #00ff41;
            text-shadow: 0 0 10px #00ff41;
            text-align: center;
            margin-bottom: 2rem;
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
        }
        
        h2 {
            color: #00d2ff;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-family: 'Orbitron', monospace;
        }
        
        .section {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff41;
            padding: 2rem;
            margin:  2rem 0;
            border-radius: 12px;
            box-shadow:  0 0 20px rgba(0, 255, 65, 0.2);
        }
        
        button {
            background: #00ff41;
            color: #000;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin:  0.5rem 0.5rem 0.5rem 0;
            font-family: 'Orbitron', monospace;
            transition: all 0.3s;
            font-size: 0.95rem;
        }
        
        button:hover {
            background: #00d2ff;
            box-shadow: 0 0 20px #00d2ff;
            transform: scale(1.05);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .output {
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid #00ff41;
            padding: 1.5rem;
            margin-top: 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 0.85rem;
            line-height: 1.6;
            max-height: 400px;
            overflow-y:  auto;
        }
        
        .status-ok {
            color: #00ff41;
        }
        
        .status-error {
            color: #ff0080;
        }
        
        .status-warning {
            color: #ffd700;
        }
        
        .wallet-info {
            background: rgba(0, 210, 255, 0.1);
            border: 1px solid #00d2ff;
            padding: 1rem;
            border-radius: 6px;
            margin:  1rem 0;
        }
        
        .wallet-address {
            font-family: 'Courier New', monospace;
            word-break: break-all;
            color: #00d2ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ZKSentinel - Blockchain Test Dashboard</h1>

        <!-- Wallet Connection Section -->
        <div class="section">
            <h2>ğŸ’³ Web3 & MetaMask Wallet Connection</h2>
            <button onclick="connectWallet()">ğŸ”— Connect MetaMask Wallet</button>
            <button onclick="getWalletInfo()" id="wallet-info-btn" disabled>ğŸ‘¤ Get Wallet Info</button>
            <button onclick="getWalletBalance()" id="balance-btn" disabled>ğŸ’° Get Balance</button>
            <button onclick="disconnectWallet()">ğŸšª Disconnect</button>
            <div id="wallet-output" class="output"></div>
            <div id="wallet-connected-info" class="wallet-info" style="display: none;">
                <p><strong>âœ… Wallet Connected!</strong></p>
                <p>Address: <span class="wallet-address" id="connected-address">-</span></p>
                <p>Network: <span id="connected-network">-</span></p>
            </div>
        </div>

        <!-- Polygon Network Section -->
        <div class="section">
            <h2>ğŸŒ Polygon Mumbai Testnet</h2>
            <button onclick="switchToPolygon()">ğŸ”„ Switch to Polygon Mumbai</button>
            <button onclick="checkNetwork()" id="network-btn" disabled>ğŸ” Check Network</button>
            <button onclick="getPolygonBalance()" id="polygon-balance-btn" disabled>ğŸ’ Get MATIC Balance</button>
            <div id="network-output" class="output"></div>
        </div>

        <!-- ZK Proof Section -->
        <div class="section">
            <h2>ğŸ” ZK Proof Generation & Verification</h2>
            <button onclick="generateZKProof()">ğŸ¯ Generate ZK Proof</button>
            <button onclick="verifyLastProof()" id="verify-btn" disabled>âœ… Verify Last Proof</button>
            <button onclick="getProofStats()">ğŸ“Š Proof Statistics</button>
            <div id="zk-output" class="output"></div>
        </div>

        <!-- Summary Section -->
        <div class="section">
            <h2>ğŸ“‹ System Status Summary</h2>
            <div id="summary" class="output status-ok"></div>
        </div>
    </div>

    <!-- Load our Web3 and ZK modules -->
    <!-- Load our Web3 and ZK modules -->
<script src="js/web3-integration.js"></script>
<script src="js/polygon-integration.js"></script>
<script src="js/zk-proof-generator.js"></script>

    <script>
        // Global state
        let walletConnected = false;
        let proofGenerated = false;

        // Wallet Connection
        async function connectWallet() {
            const output = document.getElementById('wallet-output');
            output.textContent = 'â³ Connecting wallet...';
            
            try {
                if (typeof window.ethereum === 'undefined') {
                    throw new Error('MetaMask not installed!  Download from https://metamask.io');
                }

                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                walletConnected = true;
                const account = accounts[0];
                
                output.textContent = `âœ… Wallet Connected!\n\nAddress: ${account}\n\nMetaMask is now connected to your wallet! `;
                output.classList.add('status-ok');
                output.classList.remove('status-error');

                // Show wallet info
                document.getElementById('wallet-connected-info').style.display = 'block';
                document.getElementById('connected-address').textContent = account;
                document.getElementById('connected-network').textContent = 'Loading...';

                // Enable buttons
                document.getElementById('wallet-info-btn').disabled = false;
                document.getElementById('balance-btn').disabled = false;
                document.getElementById('network-btn').disabled = false;
                document.getElementById('polygon-balance-btn').disabled = false;

                // Check network
                checkNetwork();
                updateSummary();
            } catch (error) {
                output.textContent = `âŒ Connection Failed:\n\n${error.message}`;
                output.classList.add('status-error');
                output.classList.remove('status-ok');
            }
        }

        function disconnectWallet() {
            walletConnected = false;
            document.getElementById('wallet-connected-info').style.display = 'none';
            document.getElementById('wallet-info-btn').disabled = true;
            document.getElementById('balance-btn').disabled = true;
            document.getElementById('network-btn').disabled = true;
            document.getElementById('polygon-balance-btn').disabled = true;
            
            const output = document.getElementById('wallet-output');
            output.textContent = 'âœ… Wallet Disconnected';
            output. classList.add('status-ok');
        }

        async function getWalletInfo() {
            const output = document.getElementById('wallet-output');
            
            try {
                const accounts = await window.ethereum.request({
                    method: 'eth_accounts'
                });

                const chainId = await window.ethereum.request({
                    method: 'eth_chainId'
                });

                output.textContent = `âœ… Wallet Information:\n\nAddress: ${accounts[0]}\nChain ID: ${chainId}\n\nYour wallet is ready for blockchain interactions!`;
                output.classList.add('status-ok');
                updateSummary();
            } catch (error) {
                output. textContent = `âŒ Error:  ${error.message}`;
                output.classList.add('status-error');
            }
        }

        async function getWalletBalance() {
            const output = document.getElementById('wallet-output');
            output.textContent = 'â³ Getting balance...';

            try {
                const accounts = await window.ethereum.request({
                    method: 'eth_accounts'
                });

                if (! accounts. length) {
                    throw new Error('No wallet connected');
                }

                // This requires Web3.js - for now show placeholder
                output.textContent = `âœ… Balance Check:\n\nWallet:  ${accounts[0]}\n\nNote: Balance retrieval requires Web3.js initialization.\nWhen deployed to Vercel, this will show real balances! `;
                output.classList.add('status-ok');
            } catch (error) {
                output.textContent = `âŒ Error: ${error.message}`;
                output.classList.add('status-error');
            }
        }

        // Network Functions
        async function switchToPolygon() {
            const output = document.getElementById('network-output');
            output.textContent = 'â³ Switching to Polygon Mumbai...';

            try {
                await window. ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x13881' }]
                });
                output.textContent = 'âœ… Switched to Polygon Mumbai!';
                output.classList.add('status-ok');
            } catch (error) {
                if (error.code === 4902) {
                    output.textContent = 'â³ Adding Polygon Mumbai to MetaMask...';
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId:  '0x13881',
                                chainName: 'Polygon Mumbai',
                                rpcUrls: ['https://rpc-mumbai.maticvigil.com'],
                                blockExplorerUrls: ['https://mumbai.polygonscan.com'],
                                nativeCurrency: {
                                    name: 'MATIC',
                                    symbol: 'MATIC',
                                    decimals: 18
                                }
                            }]
                        });
                        output.textContent = 'âœ… Polygon Mumbai added and switched!';
                        output.classList.add('status-ok');
                    } catch (addError) {
                        throw addError;
                    }
                } else {
                    throw error;
                }
            }
        }

        async function checkNetwork() {
            const output = document.getElementById('network-output');
            output.textContent = 'â³ Checking network... ';

            try {
                const chainId = await window.ethereum.request({
                    method: 'eth_chainId'
                });

                const isPolygon = chainId === '0x13881';
                const networkName = isPolygon ? 'Polygon Mumbai' : 'Other Network (' + chainId + ')';

                output.textContent = `âœ… Network Check:\n\nCurrent Network: ${networkName}\nChain ID: ${chainId}\n\n${isPolygon ? 'âœ… Connected to Polygon Mumbai!' : 'âš ï¸ Not on Polygon Mumbai.  Use switch button above.'}`;
                output.classList.add('status-ok');
                
                document.getElementById('connected-network').textContent = networkName;
                updateSummary();
            } catch (error) {
                output. textContent = `âŒ Error: ${error.message}`;
                output.classList.add('status-error');
            }
        }

        async function getPolygonBalance() {
            const output = document.getElementById('network-output');
            output.textContent = 'â³ Getting Polygon balance...';

            try {
                const accounts = await window.ethereum.request({
                    method: 'eth_accounts'
                });

                output.textContent = `âœ… MATIC Balance Check:\n\nWallet: ${accounts[0]}\n\nTo view your MATIC balance:\n1. Visit: https://mumbai.polygonscan.com\n2. Paste your wallet address\n3. See your MATIC balance\n\nGet free test MATIC:  https://faucet.polygon.technology/`;
                output.classList.add('status-ok');
            } catch (error) {
                output.textContent = `âŒ Error: ${error.message}`;
                output.classList.add('status-error');
            }
        }

        // ZK Proof Functions
        function generateZKProof() {
            const output = document.getElementById('zk-output');

            try {
                if (!window.zkProofGenerator) {
                    throw new Error('ZK Proof Generator not initialized');
                }

                const testData = {
                    raceId: 'RACE_' + Date.now(),
                    playerAddress: 'Player_' + Math.random().toString(36).substring(7),
                    lapTime: Math.floor(Math.random() * 200) + 60,
                    coinsEarned: Math.floor(Math.random() * 300) + 50,
                    position: Math.floor(Math.random() * 8) + 1
                };

                const proof = zkProofGenerator.generateRaceProof(testData);
                proofGenerated = true;

                output.textContent = `âœ… ZK Proof Generated!\n\n${JSON.stringify(proof, null, 2)}`;
                output.classList.add('status-ok');
                output.classList.remove('status-error');

                document.getElementById('verify-btn').disabled = false;
                updateSummary();
            } catch (error) {
                output. textContent = `âŒ Error: ${error.message}`;
                output.classList.add('status-error');
            }
        }

        function verifyLastProof() {
            const output = document.getElementById('zk-output');

            try {
                if (!window.zkProofGenerator) {
                    throw new Error('ZK Proof Generator not initialized');
                }

                const stats = zkProofGenerator.getProofStats();
                if (stats.totalProofs === 0) {
                    throw new Error('No proofs generated yet.  Click "Generate ZK Proof" first! ');
                }

                const lastProof = zkProofGenerator. proofs[zkProofGenerator.proofs.length - 1];
                const isVerified = zkProofGenerator.verifyProof(lastProof);

                output.textContent = `âœ… Proof Verification Result:\n\n${JSON.stringify({
                    proofId: lastProof.id,
                    verified: isVerified,
                    playerAddress: lastProof.playerAddress,
                    raceId: lastProof.raceId,
                    timestamp: new Date(lastProof.timestamp).toISOString(),
                    message: isVerified ? 'Proof is cryptographically valid!' : 'Proof verification failed'
                }, null, 2)}`;
                output.classList.add('status-ok');
            } catch (error) {
                output.textContent = `âŒ Error: ${error.message}`;
                output.classList.add('status-error');
            }
        }

        function getProofStats() {
            const output = document.getElementById('zk-output');

            try {
                if (!window.zkProofGenerator) {
                    throw new Error('ZK Proof Generator not initialized');
                }

                const stats = zkProofGenerator.getProofStats();
                output.textContent = `ğŸ“Š Proof Statistics:\n\n${JSON.stringify(stats, null, 2)}\n\nAll generated proofs are stored and can be verified on-chain!`;
                output.classList.add('status-ok');
            } catch (error) {
                output.textContent = `âŒ Error: ${error. message}`;
                output.classList.add('status-error');
            }
        }

        // Summary
        function updateSummary() {
            const summary = document.getElementById('summary');
            const accounts = walletConnected ? 'Connected âœ…' : 'Not Connected âŒ';
            
            summary.textContent = `System Status: 

âœ… MetaMask Extension:  Installed & Running
${accounts === 'Connected âœ…' ?  'âœ…' : 'âš ï¸'} Wallet Connection:  ${accounts}
âœ… ZK Proof Generator: Ready
âœ… Polygon Mumbai:  Configured
âœ… Web3.js Integration:  Installed

You can now:
1. Connect your MetaMask wallet
2. Switch to Polygon Mumbai testnet
3. Generate & verify ZK proofs
4. When deployed to Vercel, real wallet transactions will work! 

Next:  Push to GitHub â†’ Deploy to Vercel â†’ Go Live!  ğŸš€`;
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            updateSummary();
            console.log('âœ… ZKSentinel Dashboard Ready');
        });
    </script>
</body>
</html>